name: Software Checks

on:
  push:
    branches: [ smf21, smf20, master ]
  pull_request:
    branches: [ smf21, smf20, master ]

  workflow_dispatch:
jobs:          
  checks:
    runs-on: ubuntu-latest
    name: Software Checks
    steps:
      - uses: actions/checkout@master
      - name: Update Build Tools
        run: git submodule foreach git pull origin master
      - name: Checking Sign off
        run: if php other/buildTools/check-signed-off.php github | grep "Error:"; then php buildTools/check-signed-off.php github; exit 1; fi
      - name: Checking Licensing
        run: |
          for file in $(find . -type f -name "*.php" ! -path "./vendor/*"); do              
            RESULTS=$(php buildTools/check-license.php ${file} | grep "Error:")
            if [[ "${RESULTS}" == Error:* ]];
              echo "\n${RESULTS}\n"
              ERROR=1
            fi
          done
      - name: Checking End of File
        run: |
          for file in $(find . -type f -name "*.php" ! -path "./vendor/*"); do              
            RESULTS=$(php buildTools/check-eof.php ${file} | grep "Error:")
            if [[ "${RESULTS}" == Error:* ]];
              echo "\n${RESULTS}\n"
              ERROR=1
            fi
          done